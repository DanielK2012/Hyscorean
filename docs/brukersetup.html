<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <link rel="icon" href="img/logo64.png">
   <link rel="stylesheet" type="text/css" href="style.css">
   <link rel="stylesheet" href="highlight/matlab.css">
   <script src="highlight/highlight.pack.js"></script>
   <script>hljs.initHighlightingOnLoad();</script>
   <title>NUS setup</title>
</head>

<body>

<header>
<ul>
<li><img src="img/logo64.png", width="80%">
<li class="header-title">Hyscorean
</ul>
<p>
<br>
<ul>
<li><a href="index.html">Documentation</a>
<li><a href="references.html">Publications</a>
<li><a href="https://github.com/luisfabib/Hyscorean" target="_blank">Repository</a>
<li><a href="https://github.com/luisfabib/Hyscorean/issues" target="_blank">Report Issues</a>
</ul>
<br>
<br>
<ul> 
</ul>
</p>
</header>

<section>

<hr>
<div class="functitle">NUS Measurement Setup</div>
<hr>

<p>
Once the XEPR software is started and the spectrometer connected, the graphical user interface of XEPR should be as follows:
</p>

<center>
<img src= "img/setup1.png",  width="90%", class="center">
</center>


<p>
A new experiment must be created via the <img src= "img/setup3.png">  button in the bottom taskbar. Pressing the button prompts a new window in which the experiment can be defined. Any experiment identifier can be given via the <code>Experiment Name</code> field by the user. It is required that the experiment is defined as advanced via the <code>Pulse>Advanced</code> option and then generated by pressing the <code>Create</code> button.
</p>

<center>
<img src= "img/setup2.png",  width="70%", class="center">
</center>

<p>
Once the experiment has been created its identifier will appear listed under the toolbar. The experiment parameters need to be passed to the spectrometer via the following button: 
</p>

<center>
<img src= "img/setup4.png",  width="20%", class="center">
</center>

<p>
Next, the experiment acquisition must be set so that it runs via a PulseSPEL program instead of the default tables. To set this press the <code>FT EPR Parameters</code> button again in the bottom toolbar to prompt a new window. There the option under <code>Acquisition>Run</code> from PulseSPEL needs to be selected.
</p>

<center>
<img src= "img/setup5.png",  width="80%", class="center">
</center>

<p>
Next the PulseSPEL program and variable definition files need to be loaded. For this select the <code>PulseSPEL</code> button at the bottom of the current window to prompt the <code>PulseSPEL Programming Panel</code>.  There load the <code>.exp</code> and <code>.def</code> files via the buttons <code>Load Program</code> and <code>Load Var Def</code>. 
</p>

<hr>
<p>
NOTE: <br>
The default names for the PulseSPEL files included in the Hyscorean package are: <code>NUS_HYSCORE.exp</code> and <code>NUS_HYSCORE.def</code>.
</p>
<hr>

<p>
At any point the file displayed can be changed via the <code>Show Program</code> and <code>Show Var Def. buttons</code>.
</p>

<center>
<img src= "img/setup6.png",  width="90%", class="center">
</center>

<p>
The user does not need to make any adjustments to the PulseSPEL program and only needs to compile it via the <code>Compile</code> button. Any changes (besides the phase cycling definition) in this program are discouraged since the ProDeL program may later not be able to execute properly. If compilation is successful, the following message will be prompted:
</p>

<center>
<img src= "img/setup7.png",  width="80%", class="center">
</center>

<p>
The user can modify the variable definition file to set the experimental parameters. All parameters except for <code>d1</code>, <code>d10-d13</code> and <code>d20-d23</code> can be freely modified. These parameters are an exception since these will be later be automatically set and modified by the ProDeL program and therefore the given values here have no influence on the experiment later. Once the parameters have been set, the file must be compiled again via the <code>Compile</code> button. If compilation is successful, the following message will be prompted:
</p>

<center>
<img src= "img/setup8.png",  width="80%", class="center">
</center>

<p>
At this point the <code>PulseSPEL Programming Panel</code> can be minimized or closed and the <code>FT EPR Parameters</code> window should be updated as follows:
</p>

<center>
<img src= "img/setup9.png",  width="80%", class="center">
</center>

<hr>
<p>
NOTE: <br>
The pulse channels need to be tuned before the experiment is started. To set the phase of the pulses for the HYSCORE experiment it is recommended to run a single trace of a uniform-sampled HYSCORE experiment to properly set the phase. HYSCORE traces do not appear in the XEPR viewports using the ProDeL program and thus cannot be used for setting the phase.
</p>
<hr>

<p>
It is important to ensure that the microwave bridge is set to its pulse mode. This can be done via the <code>FT Bridge</code> button on the bottom toolbar and then in the new prompted window via <code>Bridge Configuration>Standard Configuration>Pulse Mode</code>.
</p>

<center>
<img src= "img/setup10.png",  width="80%", class="center">
</center>

<p>
The next step is to load the NUS schedule generated <a href="schedulegeneration.html">before</a> to the XEPR software. This is most easily done via the <code>File>Load…</code> button in the XEPR toolbar. There the DSC file containing the NUS schedule of choice can be loaded.
</p>

<center>
<img src= "img/setup11.png",  width="80%", class="center">
</center>

<p>
If the NUS schedule is loaded successfully the corresponding dataset will be displayed in the primary viewport with the same name as the corresponding loaded file: 
</p>

<center>
<img src= "img/setup12.png",  width="80%", class="center">
</center>

<hr>
<p>
NOTE: <br>
Recall that the t1 timings of the NUS schedule are encoded in the abscissa of the dataset while the t2 timings are encoded in the ordinate of the dataset. Therefore, the displayed data on the primary viewport may appear odd at first. This display can be ignored since it does not represent real data. 
</p>
<hr>

<p>
Next it is important to remove this dataset from the <font color="red">Primary</font> viewport via the <img src= "img/setup22.png">  button and selecting the <code>&#60;no Primary&#62;</code> option. Following this the NUS schedule dataset must be set into the <font color="green">Secondary</font> viewport again via the corresponding <img src= "img/setup22.png">  button and selecting the same name as previously displayed in the <font color="red">Primary</font> viewport. 
</p>

<center>
<img src= "img/setup13.png",  width="90%", class="center">
</center>

<p>
At this point the experiment generated at the beginning of this section must be set as the current dataset of the <font color="red">Primary</font> viewport. This is accomplished by pressing the <img src= "img/setup22.png">  button of the experiment list and selecting the name given to the advanced experiment at the beginning of this section. 
</p>

<center>
<img src= "img/setup14.png",  width="20%", class="center">
</center>

<p>
If all steps have been followed carefully the viewport status bar should now look as follows:
</p>

<center>
<img src= "img/setup15.png",  width="80%", class="center">
</center>


<hr>
<p>
NOTE: <br>
It is critical that the viewports are not modified at this point until the ProDeL program has been executed. If the datasets on the <font color="red">Primary</font> or <font color="green">Secondary</font> viewports are changed, the NUS HYSCORE measurement will not be successful and an error will be prompted by ProDeL.</p>
<hr>

<p>
The next step is to open the ProDeL program which will perform the NUS HYSCORE measurement. The <code>Programming Panel</code> can be opened by selecting the <code>Processing>ProDeL>Programming…</code> button.
</p>

<center>
<img src= "img/setup16.png",  width="90%", class="center">
</center>

<p>
The program source code can then be loaded via the <code>Load</code> button and then selecting the ProDeL program file from its location on the computer either via its file name <code>PRODEL_NUS_HYSCORE_program.ppp</code>  or via its title <code>NUS_HYSCORE_experiment</code> (by default the file can be located at the Hyscorean’s location under the <code>nus_bruker</code> directory).
</p>

<center>
<img src= "img/setup17.png",  width="90%", class="center">
</center>

<hr>
<p>
NOTE: <br>
It is recommended to copy the ProDeL file from its original location to the <code>xeprFiles/ProDeL</code> directory since this will always be opened as a default directory for ProDeL files, making the loading more comfortable.  
<hr>

<p>
The user now only needs to set a last parameter in the ProDeL program under the <code>User Input</code> section. 
</p>
<pre>
# ----------------------------------------------------------------------#
# User Input                                                            #		
# ----------------------------------------------------------------------#
# Tau values to be measured	[ns] #
# (NOTE: In PRODEL language arrays have to be filled element by element #
#        starting with index 0. Ex/ taus[0] = 100; taus[1] = 120;...  ) #
taus[0] = 144; 
taus[1] = 155;
# Number of taus to be measured #
tauDim = 2;
# ----------------------------------------------------------------------#

</pre>

<p>
There the user can introduce the different τ-values (in ns) at which the HYSCORE experiments must be measured. The <code>taus</code> array elements must be defined one by one as allowed by ProDeL. At the end the user needs to specify how many <code>tauDim</code> of these τ-values need to be measured and the program will take the <code>tauDim</code> first τ-values in the array.  After this no more input is required by the user and otherwise nothing else in the program should be modified. Any issued arising from modifications will be under the user’s responsibility.
</p>

<p>
The program can then be compiled via the Compile button and then start the program via the <code>Run</code> button. Alternatively, both steps can be executed via the <code>Compile/Run</code> button.
</p>

<p>
Once the ProDeL program starts a message window will prompt where the output of the program will be display. The program will start informing the user which NUS schedule was loaded into the program, how many HYSCORE points are to be measured from the NUS grid and the tau-values to be employed.
</p>

<p>
During the execution of ProDeL programs, the XEPR GUI is completely blocked from any user input until the program finishes execution. Nonetheless, the program can be killed at any moment via the break button on the bottom-right side of the XEPR main window. This button will pause the execution of the ProDeL program and ask the user whether the execution is to be terminated. 
</p>

<center>
<img src= "img/setup19.png",  width="60%", class="center">
</center>

<p>
Once the NUS HYSCORE measurement finished and the ProDeL execution reached the end, the <font color="red">Primary</font>  and <font color="green">Secondary</font>  viewports will be set with the complete NUS HYSCORE dataset generated by the ProDeL program under the name <code>NUS HYSCORE Experiment</code>. The data are saved in both viewports to ensure that the data is not lost should one viewport be overwritten by accident.
</p>

<center>
<img src= "img/setup20.png",  width="80%", class="center">
</center>

<hr>
<p>
NOTE: <br>
Terminating the program will stop its execution. However, if a measurement is running, terminating the program will not stop the current measurement. The user can wait for the measurement to finish or to stop if via the now active <code>Stop</code> or <code>Pause</code> buttons.
<hr>

<p> 
In the data as displayed in the viewports represent the t2-timings measured during the NUS experiment, which may look like vertical lines. If one zooms-in into one of these vertical lines, the measured t1-timings corresponding to that t2-timing can be seen.
</p>

<center>
<img src= "img/setup21.png",  width="100%", class="center">
</center>

The user now must save/export the NUS HYSCORE dataset via the <code>File>Save…</code> or <code>File>Export ASCII…</code> buttons on the main toolbar from either the <font color="red">Primary</font> or <font color="green">Secondary</font>  viewports. The files can then be loaded into Hyscorean and processed as described in <a href="reconstructionmethods.html">here</a>.



<!-- =========================================================== -->
<hr>
<a href="schedulegeneration.html" class="previous", align="left">&laquo; Previous</a>
&emsp;
<a href="license.html" class="next", style="text-align:right">Next &raquo;</a>
<hr>
</section>

<footer>
Hyscorean Documentation - Luis Fábregas Ibáñez  2019 - ETH Zurich - Released under the GNU Lesser General Public License (LGPL 3.0).
</footer>

</body>
</html>
