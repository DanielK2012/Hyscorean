<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <link rel="icon" href="img/logo64.png">
   <link rel="stylesheet" type="text/css" href="style.css">
   <link rel="stylesheet" href="highlight/matlab.css">
   <script src="highlight/highlight.pack.js"></script>
   <script>hljs.initHighlightingOnLoad();</script>
   <title>Manual Fitting</title>
</head>

<body>

<header>
<ul>
<li><img src="img/logo64.png", width="80%">
<li class="header-title">Hyscorean
</ul>
<p>
<br>
<ul>
<li><a href="index.html">Documentation</a>
<li><a href="references.html">Publications</a>
<li><a href="https://bitbucket.org/luisfabib/hyscorean/src/master/" target="_blank">Repository</a>
<li><a href="https://bitbucket.org/luisfabib/hyscorean/issues?status=new&status=open" target="_blank">Report Issues</a>
</ul>
<br>
<br>
<ul> 
</ul>
</p>
</header>

<section>

<hr>
<div class="functitle">Spectral Confinement/Exclusion</div>
<hr>

<p>
When fitting spectra via optimization methods, the progression of the fit optimization is determined by the root-mean-square deviation (RMSD) of the fit with respect of the experimental spectrum. This can become a problem when trying to fit less intese features in spectra with large dynamic ranges, e.g. in the following spectrum the fit of the <sup>1</sup>H nuclei will minimally influence the total RMSD probably leading to a unsuccessfull fitting.   
 </p>

<center>
<img src= "img/confine_exclude6.png",  width="70%", class="center">
</center>

<p>
In order to handle such situations Hyscorean offers the opportunity to confine selected regions of the spectrum to isolate the simulations. By pressing the <code>Confine</code> button the user can draw a rectangle in the spectrum to select the region of the spectrum to isolate. Upon selection, the program will draw a blue dashed rectangle corresponding to the selection. The program will then set all of the spectrum outside of the rectangle to zero and the confined spectral region will be renormalized according ot the user preferences. Still maintaining the contour levels.  At any point, the confinement can be reversed by pressing the same button now with the tag <code>Release</code> on it.
</p>

<center>
<img src= "img/confine_exclude4.png",  width="70%", class="center">
</center>

<p>
Another known issue when fitting crosspeaks in HYSCORE spectra is the influence of the intense matrix diagonal peaks, whose influence on the fit RMSD is larger than that of the peaks of interest. These peaks can be removed by means of the <code>Exclude</code> button. Be pressing it, the user can again select a rectangular region of the displayed spectrum. Once the selection is completed, a red dashed rectangle will be drawn. In contrast to before, now all elements inside the rectangle will be set to zero and everyting outside the rectangle is left unchanged. At any point, the excluded region can be recovered by pressing the same button now with the tag <code>Include</code> on it. The confinement and exclusion regions are compatible and can be overlaped as seen in this example.
</p>

<center>
<img src= "img/confine_exclude5.png",  width="70%", class="center">
</center>

<p>
Any region of the spectrum, which has been excluded or confined will be excluded or confined as well in the simulated spectra. Therefore, the influence on the RMSD and by extension on the fitting protocols of all regions set to zero will be avoided.
</p>

<!-- =========================================================== -->
<div class="subtitle">Example</div>

<p>
Here an example is shown on how to improve the fitting performance of the Nelder/Mead algorithm in the fitting module of Hyscorean. The same spectrum shown before is considered, where the crosspeaks corresponding to the <sup>1</sup>H nuclei are to be fitted. By running the algorithm with the whole spectrum active, it will lead to a fit of the matrix peak of the protons.
</p>

<center>
<img src= "img/confine_exclude1.png",  width="70%", class="center">
</center>

<p>
Now, by confining the spectrum to the proton region the spectrum will be normalized to the intensity of the matrix diagonal peak. However, due to the large difference in instensity between the diagonal and crosspeaks, the fitting algorithm still does fit only the diagonal peak. 
</p>

<center>
<img src= "img/confine_exclude2.png",  width="70%", class="center">
</center>

<p>
Finally, by excluding the diagonal peak, the crosspeaks of interest become more intense after re-normalization and the algorithm now can reach the fit of these peaks. Wihtout the need to change any parameters in the <code>Sys</code> or <code>Vary</code> structures.
</p>

<center>
<img src= "img/confine_exclude3.png",  width="70%", class="center">
</center>

<p>
The whole fit with the optimal parameters can be obtained by simply releasing the confined and/or excluded regions. 
</p>

<!-- =========================================================== -->
<hr>
<a href="manualfitting.html" class="previous", align="left">&laquo; Previous</a>
&emsp;
<a href="weightingmap.html" class="next", style="text-align:right">Next &raquo;</a>
<hr>
</section>


<footer>
Hyscorean Documentation - Luis Fábregas Ibáñez  2019 - ETH Zurich - Released under the GNU Lesser General Public License (LGPL 3.0).
</footer>

</body>
</html>

